<div class="max-w-sm overflow-hidden rounded-lg shadow-xl">
  <div class="flex flex-col justify-between gap-0.5 p-4">
    <div class="flex items-center justify-between">
      <div class="font-poppins mb-1 text-xl font-bold">{{ event.name }}</div>
      <span
        class="inline-flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-800 transition hover:bg-blue-200"
      >
        <i [class]="getEventTypeIcon(event.type)" class="mr-1"></i>
        {{ event.type }}
      </span>
    </div>
    <div><i class="fas fa-map-marker-alt mr-2 text-red-500"></i>{{ event.location }}</div>
    <div>
      <i class="fas fa-calendar-alt mr-1 text-blue-500"></i>
      {{ event.eventDate | date: 'dd/MM/yy' }} ({{ event.startTime }} - {{ event.endTime }})
    </div>

    <div>
      <i class="fas fa-tags mr-1 text-green-600"></i>
      <span class="text-gray-500 line-through">₹{{ event.originalPrice }}</span>
      ₹{{ event.price }}
    </div>

    <div>
      <i class="fas fa-chair mr-1 text-purple-500"></i> Seats available:
      {{ event.seatsAvailable }}
    </div>

    <div class="grid grid-cols-1">
      <div>
        <ng-container *ngIf="user$ | async as user; else guestView">
          <div *ngIf="!postedByUser(user) && !contactedByUser(user) && showContactSellerButton">
            <div class="flex items-center justify-between">
              <div>
                <button
                  (click)="onGetSellerContact(user)"
                  type="button"
                  class="mt-3 cursor-pointer rounded-lg bg-black px-2 py-1 text-center text-xs font-medium text-white hover:bg-gray-700 hover:text-sm"
                >
                  <i class="fas fa-envelope mr-1 text-xs text-white"></i> Contact Seller
                </button>
              </div>

              <div>
                <!-- Show More Button -->
                <button
                  (click)="showTicketDetails()"
                  class="mt-2 flex items-center justify-center rounded-lg bg-gray-100 px-2 py-1.5 text-center text-xs font-medium text-gray-700 transition hover:bg-gray-200"
                >
                  <i class="fas fa-info-circle mr-1"></i> Show More
                </button>
              </div>
            </div>
          </div>
          <div *ngIf="!postedByUser(user) && contactedByUser(user) && showContactedBy">
            <div>
              <!-- Show More Button -->
              <button
                (click)="showTicketDetails()"
                class="mt-2 flex items-center justify-center rounded-lg bg-gray-100 px-2 py-1.5 text-center text-xs font-medium text-gray-700 transition hover:bg-gray-200"
              >
                <i class="fas fa-info-circle mr-1"></i> Show More
              </button>
            </div>
            <p class="mt-2 text-xs text-black">
              <i class="fas fa-info-circle mr-1"></i>You already contacted the seller. Check your
              email.
            </p>
          </div>
          <div *ngIf="postedByUser(user) && showPostedBy">
            <div class="flex items-center justify-between">
              <div>
                <p class="mt-2 text-xs text-black">
                  <i class="fas fa-info-circle mr-1"></i>Posted by you.
                </p>
              </div>

              <div>
                <!-- Show More Button -->
                <button
                  (click)="showTicketDetails()"
                  class="mt-2 flex items-center justify-center rounded-lg bg-gray-100 px-2 py-1.5 text-center text-xs font-medium text-gray-700 transition hover:bg-gray-200"
                >
                  <i class="fas fa-info-circle mr-1"></i> Show More
                </button>
              </div>
            </div>

            <ng-container *ngIf="event.status != 'sold'">
              <div class="flex items-center justify-between">
                <button
                  *ngIf="showDeleteButton"
                  (click)="onDeleteTicket()"
                  type="button"
                  class="mt-3 cursor-pointer rounded-lg bg-black px-2 py-1 text-center text-[8px] font-medium text-white hover:bg-red-700"
                >
                  <i class="fas fa-trash mr-1 text-[10px] text-white"></i> Delete Ticket
                </button>
                <button
                  *ngIf="showMarkAsSoldButton"
                  (click)="onMarkAsSold()"
                  type="button"
                  class="mt-3 cursor-pointer rounded-lg bg-black px-2 py-1 text-center text-[8px] font-medium text-white hover:bg-blue-700"
                >
                  <i class="fas fa-check mr-1 text-[10px] text-white"></i> Mark as Sold
                </button>
                <button
                  *ngIf="showUpdateButton"
                  (click)="onUpdateTicket()"
                  type="button"
                  class="mt-3 cursor-pointer rounded-lg bg-black px-2 py-1 text-center text-[8px] font-medium text-white hover:bg-blue-700"
                >
                  <i class="fas fa-edit mr-1 text-[10px] text-white"></i> Update Ticket
                </button>
              </div>
            </ng-container>
            <ng-template *ngIf="event.status == 'sold' && showTicketIsSold">
              <p class="mt-2 text-xs text-black">
                <i class="fas fa-info-circle mr-1"></i>Ticket is sold.
              </p>
            </ng-template>
          </div>
        </ng-container>

        <ng-template #guestView>
          <button
            (click)="onGetSellerContact(null)"
            type="button"
            class="mt-3 w-30 cursor-pointer rounded-lg bg-black py-1 text-center text-xs font-medium text-white hover:bg-gray-700"
          >
            <i class="fas fa-envelope mr-1 text-xs text-white"></i> Contact Seller
          </button>
          <div>
            <!-- Show More Button -->
            <button
              (click)="showTicketDetails()"
              class="mt-2 flex items-center justify-center rounded-lg bg-gray-100 py-1.5 text-center text-xs font-medium text-gray-700 transition hover:bg-gray-200"
            >
              <i class="fas fa-info-circle mr-1"></i> Show More Details
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Template for Ticket Details Dialog -->
<ng-template #ticketDetailsTemplate let-event="event">
  <!-- Using the event as Ticket type -->
  <div class="space-y-4">
    <!-- Basic Information -->
    <div class="space-y-2">
      <div class="mb-2 text-lg font-semibold text-gray-900">Event Information</div>
      <div class="grid grid-cols-1 gap-x-6 gap-y-3 sm:grid-cols-2">
        <div>
          <div class="text-sm font-medium text-gray-500">Event Type</div>
          <div class="flex items-center text-base text-gray-900">
            <i [class]="getEventTypeIcon(event.type)" class="mr-1 text-blue-500"></i
            >{{ event.type }}
          </div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Performer</div>
          <div class="text-base text-gray-900">{{ event.performerName }}</div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Date</div>
          <div class="text-base text-gray-900">{{ event.eventDate | date: 'EEEE, MMMM d, y' }}</div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Time</div>
          <div class="text-base text-gray-900">
            {{ event.startTime }} - {{ event.endTime }} ({{ event.duration }})
          </div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Location</div>
          <div class="text-base text-gray-900">{{ event.location }}</div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Status</div>
          <div class="text-base text-gray-900 capitalize">{{ event.status }}</div>
        </div>
      </div>
    </div>

    <!-- Divider -->
    <div class="my-4 border-t border-gray-200"></div>

    <!-- Description -->
    <div *ngIf="event.description">
      <div class="mb-2 text-lg font-semibold text-gray-900">Description</div>
      <p class="text-base text-gray-700">{{ event.description }}</p>

      <div *ngIf="event.performerBio" class="mt-2">
        <div class="text-sm font-medium text-gray-500">About {{ event.performerName }}</div>
        <p class="text-sm text-gray-700">{{ event.performerBio }}</p>
      </div>
    </div>

    <!-- Divider -->
    <div class="my-4 border-t border-gray-200"></div>

    <!-- Ticket Details -->
    <div>
      <div class="mb-2 text-lg font-semibold text-gray-900">Ticket Details</div>
      <div class="grid grid-cols-1 gap-x-6 gap-y-3 sm:grid-cols-2">
        <div>
          <div class="text-sm font-medium text-gray-500">Price</div>
          <div class="text-base text-gray-900">
            <span class="mr-1 text-gray-500 line-through">₹{{ event.originalPrice }}</span>
            <span class="font-semibold">₹{{ event.price }}</span>
          </div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Seats Available</div>
          <div class="text-base text-gray-900">{{ event.seatsAvailable }}</div>
        </div>
        <div *ngIf="event.seatNumber">
          <div class="text-sm font-medium text-gray-500">Seat Numbers</div>
          <div class="text-base text-gray-900">{{ event.seatNumber }}</div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Purchase Date</div>
          <div class="text-base text-gray-900">{{ event.purchaseDate | date: 'MMM d, y' }}</div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Ticket Validity</div>
          <div class="text-base text-gray-900">
            {{ event.validFrom | date: 'shortTime' }} - {{ event.validTo | date: 'shortTime' }}
          </div>
        </div>
        <div>
          <div class="text-sm font-medium text-gray-500">Posted Date</div>
          <div class="text-base text-gray-900">{{ event.postedDate | date: 'MMM d, y' }}</div>
        </div>
      </div>
    </div>

    <!-- QR Code (if available) -->
    <!-- <div *ngIf="event.qrCodeUrl" class="mt-4 flex justify-center">
      <div class="text-center">
        <div class="mb-2 text-sm font-medium text-gray-500">Ticket QR Code</div>
        <img [src]="event.qrCodeUrl" alt="Ticket QR Code" class="h-32 w-32" />
      </div>
    </div> -->
  </div>
</ng-template>
